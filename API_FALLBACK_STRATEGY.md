# API フォールバック戦略

## 📡 メインAPI: GMOコインFX API

### 採用理由
- **完全無料**: Public API（価格取得）は完全無料
- **高速**: レイテンシテスト43.6ms実証済み
- **信頼性**: 日本の金融庁登録業者
- **リアルタイム**: WebSocket対応
- **制限**: 1秒間1回（十分な余裕）

### 利用方法
- **エンドポイント**: `https://forex-api.coin.z.com/public/v1/ticker`
- **認証**: 不要（Public API）
- **データ形式**: JSON
- **更新間隔**: 1秒

## 🛡️ フォールバック階層戦略

### Level 1: Alpha Vantage API
**切り替え条件:**
- GMOコインAPI応答時間 > 5秒
- 3回連続エラー
- HTTP Status 500系エラー

**仕様:**
- **料金**: 無料プラン（500リクエスト/日）
- **エンドポイント**: `https://www.alphavantage.co/query`
- **制限**: 5リクエスト/分
- **データ品質**: 中程度

### Level 2: モックデータシステム
**切り替え条件:**
- 全外部API利用不可
- ネットワーク障害
- 緊急時の継続運用

**仕様:**
- **データ品質**: リアルな価格変動パターン
- **レスポンス**: 即座
- **継続性**: 100%保証
- **制限**: なし

## 🔄 自動切り替えロジック

### 1. 健康状態監視
```
- API応答時間監視（目標: <2秒）
- エラー率監視（目標: <1%）  
- 5分ごとの定期確認
```

### 2. 切り替え基準
```
Level 1 → Level 2:
- 連続3回失敗
- 応答時間 > 10秒
- HTTP 5xx エラー

Level 2 → Level 3:
- 全API接続不可
- ネットワーク障害
```

### 3. 復帰条件
```
- 3回連続成功
- 応答時間正常化
- エラー率 < 1%
```

## 📊 ユーザー通知戦略

### 通知レベル
1. **情報**: データソース表示更新
2. **警告**: フォールバック切り替え通知
3. **エラー**: 全API利用不可時

### 表示内容
```
- "データ提供: GMOコイン" (通常時)
- "データ提供: Alpha Vantage (代替)" (Level 1)
- "データ提供: シミュレーション" (Level 2)
```

## 🚨 障害時対応手順

### GMOコイン仕様変更時
1. **即座にLevel 1に切り替え**
2. **開発者に通知送信**
3. **新仕様への対応開始**
4. **修正版デプロイ後に復帰**

### 長期障害時
1. **Level 2で継続運用**
2. **代替API調達開始**
3. **ユーザーへの状況説明**
4. **復旧スケジュール公開**

## 📈 運用監視項目

### 定期監視
- **API応答時間** (目標: <2秒)
- **データ更新頻度** (目標: 1秒)
- **エラー発生率** (目標: <1%)
- **フォールバック使用率** (目標: <5%)

### アラート設定
- API応答時間 > 5秒
- 連続エラー > 3回
- フォールバック切り替え発生時

---

**更新日**: 2025-09-06
**バージョン**: v1.0.0
**次回見直し**: 2025-12-06