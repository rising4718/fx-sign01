import React, { useState, useEffect } from 'react';
import { Layout, Tabs, Card, Statistic, Row, Col, Typography, Tag, Space, Button, message } from 'antd';
import { LineChartOutlined, SettingOutlined, RiseOutlined, InfoCircleOutlined, DollarOutlined, BarChartOutlined } from '@ant-design/icons';
import Chart from './components/Chart';
import LogicManagement from './components/LogicManagement';
import TradingResults from './components/TradingResults';
import FundManagement from './components/FundManagement';
import 'antd/dist/reset.css';
import './App.css';

const { Header, Content } = Layout;
const { Title, Text } = Typography;

function AppWithChart() {
  const [currentPrice, setCurrentPrice] = useState(150.123);
  const [chartData, setChartData] = useState([]);
  const [lastCandleSwitch, setLastCandleSwitch] = useState<Date | null>(null);
  const [activeTab, setActiveTab] = useState<'chart' | 'logic' | 'results' | 'fund'>('chart');
  
  // „É¨„É≥„Ç∏„Å®„Çµ„Ç§„É≥ÁÆ°ÁêÜ
  const [currentRange, setCurrentRange] = useState<{high: number, low: number, width: number} | null>(null);
  const [activeSignal, setActiveSignal] = useState<{
    type: 'buy' | 'sell',
    entryPrice: number,
    targetPrice: number,
    stopPrice: number,
    timestamp: Date
  } | null>(null);
  const [signalHistory, setSignalHistory] = useState<any[]>([]);
  const [tradingHistory, setTradingHistory] = useState(() => {
    const saved = localStorage.getItem('tradingHistory');
    return saved ? JSON.parse(saved) : [];
  });
  
  // TORB„É≠„Ç∏„ÉÉ„ÇØË®≠ÂÆöÔºà„É≠„Éº„Ç´„É´„Çπ„Éà„É¨„Éº„Ç∏„Åã„ÇâÂèñÂæóÔºâ
  const [torbSettings, setTorbSettings] = useState(() => {
    const saved = localStorage.getItem('torbSettings');
    return saved ? JSON.parse(saved) : {
      rangeStartHour: 9,
      rangeStartMinute: 0,
      rangeEndHour: 10,
      rangeEndMinute: 0,
      tradingEndHour: 17,
      tradingEndMinute: 0,
      minRangeWidth: 5,
      maxRangeWidth: 50,
      profitMultiplier: 1.5,
      stopLossBuffer: 2
    };
  });

  // „É≠„Éº„Ç´„É´„Çπ„Éà„É¨„Éº„Ç∏„ÅÆÂ§âÊõ¥„ÇíÁõ£Ë¶ñ
  useEffect(() => {
    const handleStorageChange = () => {
      const saved = localStorage.getItem('torbSettings');
      if (saved) {
        setTorbSettings(JSON.parse(saved));
      }
    };

    window.addEventListener('storage', handleStorageChange);
    
    // Âêå„Åò„Çø„ÉñÂÜÖ„Åß„ÅÆÂ§âÊõ¥„ÇÇÊ§úÁü•„Åô„Çã„Åü„ÇÅ„Å´ÂÆöÊúüÁöÑ„Å´„ÉÅ„Çß„ÉÉ„ÇØ
    const interval = setInterval(() => {
      const saved = localStorage.getItem('torbSettings');
      if (saved) {
        const newSettings = JSON.parse(saved);
        setTorbSettings(prevSettings => {
          // „Ç™„Éñ„Ç∏„Çß„ÇØ„Éà„ÅÆÂÄ§„ÅåÂ§âÊõ¥„Åï„Çå„Å¶„ÅÑ„Çã„Åã„ÉÅ„Çß„ÉÉ„ÇØ
          if (JSON.stringify(prevSettings) !== JSON.stringify(newSettings)) {
            return newSettings;
          }
          return prevSettings;
        });
      }
    }, 1000);

    return () => {
      window.removeEventListener('storage', handleStorageChange);
      clearInterval(interval);
    };
  }, []);

  // Ëá™ÂãïÂèñÂºïË®òÈå≤‰øùÂ≠ò
  const autoSaveTradingRecord = (signal: any) => {
    const tradeRecord = {
      id: Date.now(),
      date: new Date().toLocaleDateString('ja-JP'),
      signalTime: signal.timestamp,
      entryTime: new Date(),
      type: signal.type,
      entryPrice: signal.entryPrice,
      targetPrice: signal.targetPrice,
      stopPrice: signal.stopPrice,
      exitPrice: null,
      result: null,
      pips: null,
      status: 'active', // active, completed
      settings: { ...torbSettings },
      autoRecorded: true // Ëá™ÂãïË®òÈå≤„Éï„É©„Ç∞
    };
    
    const updatedHistory = [tradeRecord, ...tradingHistory];
    setTradingHistory(updatedHistory);
    localStorage.setItem('tradingHistory', JSON.stringify(updatedHistory));
    
    console.log(`üöÄ ${signal.type}„Ç∑„Ç∞„Éä„É´Áô∫Áîü ‚Üí Ëá™ÂãïË®òÈå≤ÂÆå‰∫Ü`, tradeRecord);
  };

  // ÂèñÂºïÂÆüË°å„Éè„É≥„Éâ„É©„ÉºÔºàÊâãÂãïÁî® - ‰ªäÂæå„ÅØ‰∏çË¶ÅÔºâ
  const executeTrade = () => {
    if (!activeSignal) return;
    
    // „Ç¢„ÇØ„ÉÜ„Ç£„Éñ„Ç∑„Ç∞„Éä„É´„ÇíÂèñÂºïÂ±•Ê≠¥„Å´ËøΩÂä†Ôºà„Ç®„É≥„Éà„É™„ÉºÁä∂ÊÖãÔºâ
    const tradeRecord = {
      id: Date.now(),
      date: new Date().toLocaleDateString('ja-JP'),
      signalTime: activeSignal.timestamp,
      entryTime: new Date(),
      type: activeSignal.type,
      entryPrice: activeSignal.entryPrice,
      targetPrice: activeSignal.targetPrice,
      stopPrice: activeSignal.stopPrice,
      exitPrice: null,
      result: null,
      pips: null,
      status: 'active', // active, completed
      settings: { ...torbSettings }
    };
    
    const updatedHistory = [tradeRecord, ...tradingHistory];
    setTradingHistory(updatedHistory);
    localStorage.setItem('tradingHistory', JSON.stringify(updatedHistory));
    
    // „Ç¢„ÇØ„ÉÜ„Ç£„Éñ„Ç∑„Ç∞„Éä„É´„ÇíÂ±•Ê≠¥„Å´ÁßªÂãï
    setSignalHistory(prev => [activeSignal, ...prev.slice(0, 9)]);
    setActiveSignal(null);
    
    message.success('ÂèñÂºï„ÇíÂÆüË°å„Åó„Åæ„Åó„Åü');
  };

  // ÂèñÂºïÊ±∫Ê∏à„Éè„É≥„Éâ„É©„Éº
  const closeTrade = (tradeId: number, exitPrice: number, result: 'win' | 'loss') => {
    const updatedHistory = tradingHistory.map((trade: any) => {
      if (trade.id === tradeId && trade.status === 'active') {
        const pips = trade.type === 'buy' 
          ? (exitPrice - trade.entryPrice) * 10000 
          : (trade.entryPrice - exitPrice) * 10000;
        
        return {
          ...trade,
          exitTime: new Date(),
          exitPrice,
          result,
          pips: Number(pips.toFixed(1)),
          status: 'completed'
        };
      }
      return trade;
    });
    
    setTradingHistory(updatedHistory);
    localStorage.setItem('tradingHistory', JSON.stringify(updatedHistory));
    
    message.success(`ÂèñÂºï„ÇíÊ±∫Ê∏à„Åó„Åæ„Åó„ÅüÔºà${result === 'win' ? 'Âà©Á¢∫' : 'ÊêçÂàá„Çä'}Ôºâ`);
  };

  useEffect(() => {
    let basePrice = 150.0;
    
    // 15ÂàÜÂå∫Âàá„Çä„ÅÆÊ≠£Á¢∫„Å™ÊôÇÈñì„ÇíË®àÁÆó„Åô„ÇãÈñ¢Êï∞
    const get15MinuteTime = (date: Date) => {
      const minutes = date.getMinutes();
      const roundedMinutes = Math.floor(minutes / 15) * 15;
      return new Date(date.getFullYear(), date.getMonth(), date.getDate(), date.getHours(), roundedMinutes, 0, 0);
    };
    
    // ÁèæÂú®„ÅÆ15ÂàÜÂå∫Âàá„ÇäÊôÇÈñì„ÇíÂèñÂæó
    const now = new Date();
    let currentCandleStart = get15MinuteTime(now);
    
    // ÂàùÊúü„Éá„Éº„ÇøÁîüÊàêÔºàÈÅéÂéª19Êú¨ + ÁèæÂú®ÈÄ≤Ë°å‰∏≠„ÅÆ1Êú¨Ôºâ
    const generateInitialData = () => {
      const data = [];
      
      // ÈÅéÂéª19Êú¨„ÅÆÂÆåÊàê„Åï„Çå„Åü„É≠„Éº„ÇΩ„ÇØË∂≥ÔºàÊ≠£Á¢∫„Å™15ÂàÜÂàª„ÅøÔºâ
      for (let i = 19; i >= 1; i--) {
        const candleDate = new Date(currentCandleStart.getTime() - i * 15 * 60 * 1000);
        const candleTime = Math.floor(candleDate.getTime() / 1000);
        const change = (Math.random() - 0.5) * 0.005;
        
        const open = basePrice;
        const close = basePrice + change;
        const high = Math.max(open, close) + Math.random() * 0.002;
        const low = Math.min(open, close) - Math.random() * 0.002;
        
        data.push({
          time: candleTime,
          open: Number(open.toFixed(3)),
          high: Number(high.toFixed(3)),
          low: Number(low.toFixed(3)),
          close: Number(close.toFixed(3))
        });
        
        basePrice = close;
      }
      
      // ÁèæÂú®ÈÄ≤Ë°å‰∏≠„ÅÆ„É≠„Éº„ÇΩ„ÇØË∂≥ÔºàÊúÄÂàù„ÅÆÂÄ§Ôºâ
      const currentTime = Math.floor(currentCandleStart.getTime() / 1000);
      const currentOpen = basePrice;
      data.push({
        time: currentTime,
        open: Number(currentOpen.toFixed(3)),
        high: Number(currentOpen.toFixed(3)),
        low: Number(currentOpen.toFixed(3)),
        close: Number(currentOpen.toFixed(3))
      });
      
      return data;
    };

    // „É¨„É≥„Ç∏Ë®àÁÆó„Å®„Çµ„Ç§„É≥Ê§úÁü•
    const calculateRange = (data: any[]) => {
      const now = new Date();
      const currentHour = now.getHours();
      const currentMinute = now.getMinutes();
      
      // „É¨„É≥„Ç∏ÂΩ¢ÊàêÊôÇÈñì„Åã„ÉÅ„Çß„ÉÉ„ÇØ
      const isInRangeTime = (
        currentHour === torbSettings.rangeStartHour && currentMinute >= torbSettings.rangeStartMinute
      ) || (
        currentHour === torbSettings.rangeEndHour && currentMinute < torbSettings.rangeEndMinute
      ) || (
        currentHour > torbSettings.rangeStartHour && currentHour < torbSettings.rangeEndHour
      );
      
      // „Éñ„É¨„Ç§„ÇØ„Ç¢„Ç¶„ÉàÁõ£Ë¶ñÊôÇÈñì„Åã„ÉÅ„Çß„ÉÉ„ÇØ
      const isBreakoutTime = currentHour >= torbSettings.rangeEndHour && currentHour < torbSettings.tradingEndHour;
      
      if (isInRangeTime) {
        // „É¨„É≥„Ç∏ÂΩ¢ÊàêÊúüÈñìÔºöÊúÄÈ´òÂÄ§„ÉªÊúÄÂÆâÂÄ§„ÇíË®àÁÆó
        const rangeData = data.slice(-4); // Áõ¥Ëøë1ÊôÇÈñìÂàÜÔºà15ÂàÜË∂≥4Êú¨Ôºâ
        if (rangeData.length >= 4) {
          const high = Math.max(...rangeData.map(d => d.high));
          const low = Math.min(...rangeData.map(d => d.low));
          const width = (high - low) * 10000; // pipsÊèõÁÆó
          
          if (width >= torbSettings.minRangeWidth && width <= torbSettings.maxRangeWidth) {
            setCurrentRange({ high, low, width: Number(width.toFixed(1)) });
          }
        }
      } else if (isBreakoutTime && currentRange && !activeSignal) {
        // „Éñ„É¨„Ç§„ÇØ„Ç¢„Ç¶„ÉàÁõ£Ë¶ñÔºö„Çµ„Ç§„É≥ÁîüÊàê
        const currentPriceValue = data[data.length - 1]?.close || currentPrice;
        
        if (currentPriceValue > currentRange.high) {
          // ‰∏äÊäú„Åë„Éñ„É¨„Ç§„ÇØ„Ç¢„Ç¶„Éà ‚Üí Ë≤∑„ÅÑ„Çµ„Ç§„É≥
          const target = currentPriceValue + (currentRange.width / 10000) * torbSettings.profitMultiplier;
          const stop = currentRange.low - (torbSettings.stopLossBuffer / 10000);
          
          const signal = {
            type: 'buy' as const,
            entryPrice: Number(currentPriceValue.toFixed(3)),
            targetPrice: Number(target.toFixed(3)),
            stopPrice: Number(stop.toFixed(3)),
            timestamp: new Date()
          };
          
          setActiveSignal(signal);
          
          // üî• Ëá™Âãï„ÅßÂèñÂºïË®òÈå≤„Çí‰øùÂ≠ò
          autoSaveTradingRecord(signal);
          
        } else if (currentPriceValue < currentRange.low) {
          // ‰∏ãÊäú„Åë„Éñ„É¨„Ç§„ÇØ„Ç¢„Ç¶„Éà ‚Üí Â£≤„Çä„Çµ„Ç§„É≥
          const target = currentPriceValue - (currentRange.width / 10000) * torbSettings.profitMultiplier;
          const stop = currentRange.high + (torbSettings.stopLossBuffer / 10000);
          
          const signal = {
            type: 'sell' as const,
            entryPrice: Number(currentPriceValue.toFixed(3)),
            targetPrice: Number(target.toFixed(3)),
            stopPrice: Number(stop.toFixed(3)),
            timestamp: new Date()
          };
          
          setActiveSignal(signal);
          
          // üî• Ëá™Âãï„ÅßÂèñÂºïË®òÈå≤„Çí‰øùÂ≠ò
          autoSaveTradingRecord(signal);
        }
      } else if (currentHour >= torbSettings.tradingEndHour) {
        // ÂèñÂºïÁµÇ‰∫ÜÊôÇÈñìÔºö„É™„Çª„ÉÉ„Éà
        setCurrentRange(null);
        setActiveSignal(null);
      }
    };

    // ÊúÄÂæå„ÅÆ„É≠„Éº„ÇΩ„ÇØË∂≥„ÇíÊõ¥Êñ∞„Åô„ÇãÈñ¢Êï∞Ôºà15ÂàÜ‰ª•ÂÜÖ„ÅÆ‰æ°Ê†ºÂ§âÂãïÔºâ
    const updateCurrentCandle = (prevData: any[]) => {
      if (prevData.length === 0) return prevData;
      
      const newData = [...prevData];
      const lastCandle = newData[newData.length - 1];
      const now = new Date();
      
      // ÂÆüÈöõ„ÅÆ15ÂàÜÂå∫Âàá„ÇäÊôÇÂàª„Çí„ÉÅ„Çß„ÉÉ„ÇØ
      const next15MinTime = get15MinuteTime(new Date(currentCandleStart.getTime() + 15 * 60 * 1000));
      
      // ÁèæÂú®ÊôÇÂàª„ÅåÊ¨°„ÅÆ15ÂàÜÂå∫Âàá„ÇäÊôÇÂàª„Å´ÈÅî„Åó„Åü„Åã„ÉÅ„Çß„ÉÉ„ÇØ
      if (now >= next15MinTime) {
        // Êñ∞„Åó„ÅÑ15ÂàÜË∂≥„ÇíÈñãÂßã
        currentCandleStart = next15MinTime;
        const newCandleTime = Math.floor(currentCandleStart.getTime() / 1000);
        const newOpen = lastCandle.close;
        
        // „Éá„Éê„ÉÉ„Ç∞„É≠„Ç∞ÔºöÊñ∞„Åó„ÅÑ„É≠„Éº„ÇΩ„ÇØË∂≥‰ΩúÊàê
        const switchTime = new Date();
        console.log(`üïê Êñ∞„Åó„ÅÑ„É≠„Éº„ÇΩ„ÇØË∂≥‰ΩúÊàê: ${switchTime.toLocaleTimeString('ja-JP')} (‰∫àÂÆöÊôÇÂàª: ${next15MinTime.toLocaleTimeString('ja-JP')})`);
        setLastCandleSwitch(switchTime);
        
        const newCandle = {
          time: newCandleTime,
          open: Number(newOpen.toFixed(3)),
          high: Number(newOpen.toFixed(3)),
          low: Number(newOpen.toFixed(3)),
          close: Number(newOpen.toFixed(3))
        };
        
        // Âè§„ÅÑ„Éá„Éº„Çø„ÇíÂâäÈô§„Åó„Å¶Êñ∞„Åó„ÅÑ„É≠„Éº„ÇΩ„ÇØË∂≥„ÇíËøΩÂä†
        newData.splice(0, 1);
        newData.push(newCandle);
      } else {
        // ÁèæÂú®„ÅÆ„É≠„Éº„ÇΩ„ÇØË∂≥„ÇíÊõ¥Êñ∞Ôºà‰æ°Ê†ºÂ§âÂãïÔºâ
        const change = (Math.random() - 0.5) * 0.003;
        const newClose = lastCandle.close + change;
        
        lastCandle.close = Number(newClose.toFixed(3));
        lastCandle.high = Number(Math.max(lastCandle.high, newClose).toFixed(3));
        lastCandle.low = Number(Math.min(lastCandle.low, newClose).toFixed(3));
      }
      
      setCurrentPrice(lastCandle.close);
      
      // „É¨„É≥„Ç∏Ë®àÁÆó„Å®„Çµ„Ç§„É≥Ê§úÁü•„ÇíÂÆüË°å
      calculateRange(newData);
      
      return newData;
    };

    // ÂàùÊúü„Éá„Éº„ÇøË®≠ÂÆö
    const initialData = generateInitialData();
    setChartData(initialData);
    setCurrentPrice(initialData[initialData.length - 1]?.close || 150.123);

    // 1Áßí„Åî„Å®„Å´ÁèæÂú®„ÅÆ„É≠„Éº„ÇΩ„ÇØË∂≥„ÇíÊõ¥Êñ∞Ôºà„É™„Ç¢„É´„Çø„Ç§„É†‰æ°Ê†ºÂ§âÂãïÔºâ
    const interval = setInterval(() => {
      setChartData(prevData => updateCurrentCandle(prevData));
    }, 1000);

    return () => clearInterval(interval);
  }, []);

  const tabItems = [
    {
      key: 'chart',
      label: (
        <span>
          <LineChartOutlined />
          „ÉÅ„É£„Éº„ÉàÂàÜÊûê
        </span>
      ),
      children: (
        <div>
          <Row gutter={[16, 16]}>
            <Col span={18}>
              <Card 
                title={
                  <Space>
                    <RiseOutlined />
                    <Text strong>USD/JPY - 15ÂàÜË∂≥„ÉÅ„É£„Éº„Éà</Text>
                  </Space>
                }
                style={{ height: '100%' }}
              >
                <Chart data={chartData} width={950} height={500} />
              </Card>
            </Col>
            
            <Col span={6}>
              <Space direction="vertical" size="middle" style={{ width: '100%' }}>
                <Card 
                  title={
                    <span>
                      <InfoCircleOutlined /> Êù±‰∫¨ÊôÇÈñì„É¨„É≥„Ç∏„Éñ„É¨„Ç§„ÇØ„Ç¢„Ç¶„Éà
                    </span>
                  } 
                  size="small"
                >
                  <Space direction="vertical" size="small" style={{ width: '100%' }}>
                    <div>
                      <Text type="secondary" style={{ fontSize: '12px' }}>„É¨„É≥„Ç∏ÊôÇÈñì</Text>
                      <br />
                      <Text strong>
                        {torbSettings.rangeStartHour.toString().padStart(2, '0')}:{torbSettings.rangeStartMinute.toString().padStart(2, '0')} - 
                        {torbSettings.rangeEndHour.toString().padStart(2, '0')}:{torbSettings.rangeEndMinute.toString().padStart(2, '0')}
                      </Text>
                    </div>
                    <div>
                      <Text type="secondary" style={{ fontSize: '12px' }}>„É¨„É≥„Ç∏ÂπÖ</Text>
                      <br />
                      <Text strong>{torbSettings.minRangeWidth} - {torbSettings.maxRangeWidth} pips</Text>
                    </div>
                    <div>
                      <Text type="secondary" style={{ fontSize: '12px' }}>Âà©Á¢∫ÂÄçÁéá / ÂèñÂºïÁµÇ‰∫Ü</Text>
                      <br />
                      <Text strong>
                        {torbSettings.profitMultiplier}x / {torbSettings.tradingEndHour.toString().padStart(2, '0')}:{torbSettings.tradingEndMinute.toString().padStart(2, '0')}
                      </Text>
                    </div>
                  </Space>
                  <div style={{ marginTop: 12 }}>
                    <Tag color="blue">„É¨„É≥„Ç∏„Éñ„É¨„Ç§„ÇØ„Ç¢„Ç¶„ÉàÊà¶Áï•</Tag>
                  </div>
                </Card>

                <Card title="„Ç∑„Ç∞„Éä„É´Áä∂Ê≥Å" size="small">
                  {activeSignal ? (
                    <Space direction="vertical" size="small" style={{ width: '100%' }}>
                      <div style={{ 
                        background: activeSignal.type === 'buy' ? '#f6ffed' : '#fff2e8',
                        padding: '8px',
                        borderRadius: '4px',
                        border: `1px solid ${activeSignal.type === 'buy' ? '#b7eb8f' : '#ffbb96'}`
                      }}>
                        <Text strong style={{ 
                          color: activeSignal.type === 'buy' ? '#52c41a' : '#fa8c16',
                          fontSize: '14px'
                        }}>
                          üö® {activeSignal.type === 'buy' ? 'Ë≤∑„ÅÑ„Ç∑„Ç∞„Éä„É´' : 'Â£≤„Çä„Ç∑„Ç∞„Éä„É´'}
                        </Text>
                      </div>
                      <div>
                        <Text type="secondary" style={{ fontSize: '12px' }}>„Ç®„É≥„Éà„É™„Éº‰æ°Ê†º</Text>
                        <br />
                        <Text strong>{activeSignal.entryPrice}</Text>
                      </div>
                      <div>
                        <Text type="secondary" style={{ fontSize: '12px' }}>Âà©Á¢∫ÁõÆÊ®ô / ÊêçÂàá„Çä</Text>
                        <br />
                        <Text strong style={{ color: '#52c41a' }}>{activeSignal.targetPrice}</Text>
                        <Text> / </Text>
                        <Text strong style={{ color: '#f5222d' }}>{activeSignal.stopPrice}</Text>
                      </div>
                      <div>
                        <Text type="secondary" style={{ fontSize: '10px' }}>
                          {activeSignal.timestamp.toLocaleTimeString('ja-JP')} Áô∫Áîü
                        </Text>
                      </div>
                      <div style={{ 
                        background: '#e6f7ff', 
                        padding: '8px', 
                        borderRadius: '4px',
                        border: '1px solid #91d5ff',
                        textAlign: 'center'
                      }}>
                        <Text style={{ fontSize: '12px', color: '#1890ff' }}>
                          ‚úÖ ÂèñÂºïË®òÈå≤„ÇíËá™Âãï‰øùÂ≠ò„Åó„Åæ„Åó„Åü
                        </Text>
                      </div>
                    </Space>
                  ) : currentRange ? (
                    <Space direction="vertical" size="small" style={{ width: '100%' }}>
                      <Tag color="blue">„É¨„É≥„Ç∏ÂΩ¢Êàê‰∏≠</Tag>
                      <div>
                        <Text type="secondary" style={{ fontSize: '12px' }}>High / Low</Text>
                        <br />
                        <Text>{currentRange.high} / {currentRange.low}</Text>
                      </div>
                      <div>
                        <Text type="secondary" style={{ fontSize: '12px' }}>„É¨„É≥„Ç∏ÂπÖ</Text>
                        <br />
                        <Text strong>{currentRange.width} pips</Text>
                      </div>
                    </Space>
                  ) : (
                    <Tag color="orange">ÂæÖÊ©ü‰∏≠</Tag>
                  )}
                </Card>

                <Card title="„Éá„Éê„ÉÉ„Ç∞ÊÉÖÂ†±" size="small">
                  <Space direction="vertical" size="small" style={{ width: '100%' }}>
                    <div>
                      <Text type="secondary" style={{ fontSize: '12px' }}>ÁèæÂú®ÊôÇÂàª</Text>
                      <br />
                      <Text code>{new Date().toLocaleTimeString('ja-JP')}</Text>
                    </div>
                    
                    {lastCandleSwitch && (
                      <div>
                        <Text type="secondary" style={{ fontSize: '12px' }}>ÊúÄÂæå„ÅÆË∂≥ÂàáÊõø</Text>
                        <br />
                        <Text code>{lastCandleSwitch.toLocaleTimeString('ja-JP')}</Text>
                      </div>
                    )}
                    
                    {chartData.length > 0 && (
                      <div>
                        <Text type="secondary" style={{ fontSize: '12px' }}>ÁèæÂú®„ÅÆË∂≥ÊôÇÂàª</Text>
                        <br />
                        <Text code>
                          {new Date(chartData[chartData.length - 1].time * 1000).toLocaleTimeString('ja-JP')}
                        </Text>
                      </div>
                    )}
                  </Space>
                </Card>
              </Space>
            </Col>
          </Row>
        </div>
      )
    },
    {
      key: 'logic',
      label: (
        <span>
          <SettingOutlined />
          Êà¶Áï•Ë®≠ÂÆö
        </span>
      ),
      children: <LogicManagement />
    },
    {
      key: 'results',
      label: (
        <span>
          <BarChartOutlined />
          ÂèñÂºïÂÆüÁ∏æ
        </span>
      ),
      children: <TradingResults />
    },
    {
      key: 'fund',
      label: (
        <span>
          <DollarOutlined />
          Ë≥áÈáëÁÆ°ÁêÜ
        </span>
      ),
      children: <FundManagement />
    }
  ];

  return (
    <Layout style={{ minHeight: '100vh' }}>
      <Header style={{ 
        background: 'linear-gradient(135deg, #1e3c72 0%, #2a5298 100%)',
        display: 'flex', 
        alignItems: 'center', 
        justifyContent: 'space-between',
        padding: '0 24px'
      }}>
        <div>
          <Title level={2} style={{ color: 'white', margin: 0 }}>
            FX Sign Tool - Phase 2
          </Title>
        </div>
        
        <div style={{ display: 'flex', alignItems: 'center', gap: '16px' }}>
          <Text style={{ color: 'white', fontSize: '16px' }}>USD/JPY</Text>
          <Statistic
            value={currentPrice}
            precision={3}
            valueStyle={{ 
              color: 'white', 
              fontSize: '24px', 
              fontFamily: 'Monaco, Menlo, monospace' 
            }}
          />
        </div>
      </Header>

      <Content style={{ padding: '24px', background: '#f5f5f5' }}>
        <Tabs
          defaultActiveKey="chart"
          items={tabItems}
          size="large"
          style={{ 
            background: 'white',
            borderRadius: '8px',
            padding: '16px'
          }}
        />
      </Content>
    </Layout>
  );
}

export default AppWithChart;